%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4a90d9', 'primaryTextColor': '#fff', 'primaryBorderColor': '#2c5282', 'lineColor': '#718096'}}}%%
flowchart TB
    subgraph PATTERN["Pattern Structure"]
        direction TB

        subgraph HEADER["Identity"]
            NUM["Number<br/>(1-253)"]
            NAME["Name"]
            STARS["Asterisks<br/>** = invariant<br/>* = progress<br/>none = uncertain"]
        end

        subgraph CONTEXT_BLOCK["Context"]
            CTX["Context Paragraph<br/><i>Links to larger patterns<br/>that contain this one</i>"]
            PREC["Preceding Patterns<br/>[P12, P45, P67...]"]
        end

        subgraph PROBLEM_BLOCK["Problem"]
            PROB_SUM["Problem Summary<br/><b>(bold headline)</b>"]
            PROB_DET["Problem Details<br/><i>Background, evidence,<br/>manifestations</i>"]
        end

        subgraph SOLUTION_BLOCK["Solution"]
            SOL["Solution<br/><b>(bold instruction)</b>"]
            DIAG["Diagram<br/><i>Visual representation</i>"]
        end

        subgraph CONNECTIONS_BLOCK["Connections"]
            CONN["Connections Paragraph<br/><i>Links to smaller patterns<br/>needed to complete this one</i>"]
            FOLL["Following Patterns<br/>[P89, P102, P156...]"]
        end
    end

    HEADER --> CONTEXT_BLOCK
    CONTEXT_BLOCK --> PROBLEM_BLOCK
    PROBLEM_BLOCK --> SOLUTION_BLOCK
    SOLUTION_BLOCK --> CONNECTIONS_BLOCK

    subgraph FLOW["Reading Flow"]
        direction LR
        F1["1. Where am I?<br/>(Context)"]
        F2["2. What's wrong?<br/>(Problem)"]
        F3["3. What do I do?<br/>(Solution)"]
        F4["4. What's next?<br/>(Connections)"]
        F1 --> F2 --> F3 --> F4
    end

    classDef header fill:#805ad5,stroke:#553c9a,color:#fff
    classDef context fill:#4299e1,stroke:#2b6cb0,color:#fff
    classDef problem fill:#e53e3e,stroke:#c53030,color:#fff
    classDef solution fill:#48bb78,stroke:#276749,color:#fff
    classDef connections fill:#ed8936,stroke:#c05621,color:#fff
    classDef flow fill:#718096,stroke:#4a5568,color:#fff

    class NUM,NAME,STARS header
    class CTX,PREC context
    class PROB_SUM,PROB_DET problem
    class SOL,DIAG solution
    class CONN,FOLL connections
    class F1,F2,F3,F4 flow
